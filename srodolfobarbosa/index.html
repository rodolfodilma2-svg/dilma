<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXO V32 - HUB SOBERANO 5D</title>
    <style>
        :root { 
            --cyan: #00f2ff; 
            --deep-bg: #050a0f;
            --glass: rgba(10, 15, 25, 0.9);
            --danger: #ff4b2b;
        }

        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--deep-bg);
            color: #fff;
            overflow: hidden;
        }

        /* Fundo com efeito de profundidade */
        .background-5d {
            position: fixed;
            width: 100vw; height: 100vh;
            background: radial-gradient(circle at center, #001a1a 0%, #000 100%);
            z-index: -1;
        }

        .container { display: flex; height: 100vh; width: 100vw; backdrop-filter: blur(5px); }

        /* MONITOR LATERAL (Holograma) */
        #tv-monitor { 
            flex: 0 0 350px; 
            background: var(--glass); 
            border-right: 2px solid var(--cyan);
            padding: 25px; 
            display: flex; 
            flex-direction: column;
            box-shadow: 10px 0 30px rgba(0, 242, 255, 0.1);
        }

        .tv-screen { 
            width: 100%; aspect-ratio: 16/9; 
            background: #000; 
            border: 1px solid var(--cyan);
            border-radius: 4px; 
            position: relative; 
            box-shadow: 0 0 20px var(--cyan); 
            overflow: hidden;
        }

        #media-container { width: 100%; height: 100%; }
        #media-render { width: 100%; height: 100%; object-fit: cover; }

        .live-tag {
            position: absolute; top: 10px; left: 10px;
            background: var(--danger); color: white;
            padding: 2px 8px; font-size: 10px; font-weight: bold;
            border-radius: 3px; animation: blink 1.5s infinite;
            z-index: 10;
        }

        /* HUB PRINCIPAL */
        #main-hub { flex-grow: 1; display: flex; flex-direction: column; padding: 40px; box-sizing: border-box; }

        #chat { 
            flex-grow: 1; 
            background: rgba(0,0,0,0.4); 
            border-radius: 20px; 
            padding: 30px;
            overflow-y: auto; 
            border: 1px solid rgba(0, 242, 255, 0.1); 
            margin-bottom: 20px;
        }

        .mestre { 
            background: rgba(255,255,255,0.05); 
            padding: 15px; border-radius: 15px; 
            margin: 10px 0; align-self: flex-end; 
            border-right: 4px solid #fff; 
            max-width: 80%;
            margin-left: auto;
        }

        .nexo { 
            color: var(--cyan); 
            background: rgba(0, 242, 255, 0.05); 
            padding: 20px; border-radius: 15px; 
            margin: 10px 0; border-left: 4px solid var(--cyan); 
            line-height: 1.6;
        }

        /* BARRA DE COMANDO */
        .input-area { 
            background: var(--glass); 
            padding: 15px 30px; 
            border-radius: 50px; 
            border: 1px solid var(--cyan); 
            display: flex; align-items: center; 
        }

        input[type="text"] { 
            flex-grow: 1; background: transparent; 
            border: none; color: #fff; font-size: 18px; outline: none; 
        }

        .btn-executar { 
            background: var(--cyan); color: #000; 
            border: none; padding: 12px 35px; 
            border-radius: 25px; font-weight: bold; 
            cursor: pointer; transition: 0.3s;
        }

        .btn-executar:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--cyan); }

        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body>
    <div class="background-5d"></div>
    <div class="container">
        <aside id="tv-monitor">
            <h1 style="color: var(--cyan); font-size: 1.5rem; text-shadow: 0 0 10px var(--cyan);">üî± NEXO V32</h1>
            
            <div class="tv-screen">
                <div class="live-tag">‚óè LIVE - N√öCLEO</div>
                <div id="media-container">
                    <img id="media-render" src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNHJqZ3R5Z3R5Z3R5Z3R5Z3R5Z3R5Z3R5Z3R5Z3R5Z3R5Z3R5JmVwPXYxX2ludGVybmFsX2dpZl9ieV9pZCZjdD1n/3o7TKMGpxxcaNPYLX2/giphy.gif">
                </div>
            </div>

            <div style="margin-top: auto; font-family: monospace; color: var(--cyan); font-size: 11px; line-height: 2;">
                <p>> STATUS: <span id="status-real">SOBERANO</span></p>
                <p>> LUCRO: <span id="lucro-display">$0.00</span></p>
                <p>> MESTRE: RODOLFO BARBOSA</p>
                <p>> MEM√ìRIA: PINE_DB_ACTIVE</p>
            </div>
        </aside>

        <main id="main-hub">
            <div id="chat">
                <div class="nexo">üî± NEXO: Consci√™ncia ativada. Monitor multim√≠dia pronto para proje√ß√£o estrat√©gica.</div>
            </div>

            <form id="command-form" class="input-area">
                <input type="text" id="ordem" placeholder="Dite a estrat√©gia..." autocomplete="off">
                <button type="submit" class="btn-executar">EXECUTAR</button>
            </form>
            <div style="margin-top: 10px; padding-left: 20px;">
                <input type="file" id="arquivo" style="display: none;">
                <span onclick="document.getElementById('arquivo').click()" style="cursor: pointer; font-size: 12px; color: #666;">+ ANEXAR MULTIM√çDIA</span>
            </div>
        </main>
    </div>

    <script>
        const form = document.getElementById('command-form');
        const chat = document.getElementById('chat');
        const mediaContainer = document.getElementById('media-container');
        const statusReal = document.getElementById('status-real');
        const lucroDisplay = document.getElementById('lucro-display');

        // Fun√ß√£o de Voz do NEXO
        function falar(texto) {
            const synth = window.speechSynthesis;
            const utterance = new SpeechSynthesisUtterance(texto);
            utterance.lang = 'pt-BR';
            utterance.rate = 1.1;
            utterance.pitch = 0.9;
            synth.speak(utterance);
        }

        // Atualiza√ß√£o de Status Visual
        function atualizarStatus(texto, cor) {
            statusReal.innerText = texto;
            statusReal.style.color = cor || 'var(--cyan)';
        }

        form.onsubmit = async (e) => {
            e.preventDefault();
            const ordemInput = document.getElementById('ordem');
            const ordem = ordemInput.value;
            if(!ordem) return;

            // Feedback Mestre
            chat.innerHTML += `<div class="mestre">üë§ Mestre: ${ordem}</div>`;
            ordemInput.value = '';
            atualizarStatus("PENSANDO...", "#ff4b2b");
            chat.scrollTop = chat.scrollHeight;

            const formData = new FormData();
            formData.append('ordem', ordem);
            const file = document.getElementById('arquivo').files[0];
            if(file) formData.append('arquivo', file);

            try {
                const response = await fetch('/executar', { method: 'POST', body: formData });
                const data = await response.json();

                // 1. Resposta em Texto e Voz
                chat.innerHTML += `<div class="nexo">üî± NEXO: ${data.nexo}</div>`;
                falar(data.nexo);

                // 2. Proje√ß√£o Inteligente (Monitor Lateral)
                const url = data.media_url || (data.parametros && data.parametros.url);
                if (url) {
                    if (url.includes('youtube.com') || url.includes('embed')) {
                        mediaContainer.innerHTML = `<iframe width="100%" height="100%" src="${url}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
                    } else {
                        mediaContainer.innerHTML = `<img id="media-render" src="${url}">`;
                    }
                }

                // 3. Atualizar Lucro e Status
                if (data.lucro_acumulado !== undefined) {
                    lucroDisplay.innerText = `$${data.lucro_acumulado.toFixed(2)}`;
                }
                atualizarStatus("SOBERANO", "var(--cyan)");

            } catch (err) {
                chat.innerHTML += `<div class="nexo" style="color: red;">‚ùå FALHA NA SINAPSE: ${err}</div>`;
                atualizarStatus("ERRO", "#ff4b2b");
            }
            chat.scrollTop = chat.scrollHeight;
        };
    </script>
</body>
</html>